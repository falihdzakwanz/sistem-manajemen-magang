<!doctype html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Storage Files</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
            }
            .file-test {
                margin: 20px 0;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
            }
            .success {
                background-color: #d4edda;
                border-color: #c3e6cb;
            }
            .error {
                background-color: #f8d7da;
                border-color: #f5c6cb;
            }
            button {
                padding: 10px 15px;
                margin: 5px;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            button:hover {
                background: #0056b3;
            }
            .download-btn {
                background: #28a745;
            }
            .download-btn:hover {
                background: #1e7e34;
            }
        </style>
    </head>
    <body>
        <h1>Test Storage File Access</h1>

        <div class="file-test">
            <h3>Test PDF File (Surat Pengantar)</h3>
            <p>File: storage/surat-pengantar/Laporan Akhir MBKM_1751789819.pdf</p>
            <button onclick="previewFile('/storage/surat-pengantar/Laporan%20Akhir%20MBKM_1751789819.pdf')">Preview PDF</button>
            <button
                class="download-btn"
                onclick="downloadFile('/storage/surat-pengantar/Laporan%20Akhir%20MBKM_1751789819.pdf', 'Laporan_Akhir_MBKM.pdf')"
            >
                Download PDF
            </button>
        </div>

        <div class="file-test">
            <h3>Test DOCX File (CV)</h3>
            <p>File: storage/cv/FORM-SURAT-PERMOHONAN-KERJA-PRAKTIK_1751440662.docx</p>
            <button onclick="previewFile('/storage/cv/FORM-SURAT-PERMOHONAN-KERJA-PRAKTIK_1751440662.docx')">Preview DOCX</button>
            <button
                class="download-btn"
                onclick="downloadFile('/storage/cv/FORM-SURAT-PERMOHONAN-KERJA-PRAKTIK_1751440662.docx', 'Form_Surat_Permohonan_KP.docx')"
            >
                Download DOCX
            </button>
        </div>

        <div id="result" class="file-test">
            <h3>Test Results:</h3>
            <div id="test-output"></div>
        </div>

        <script>
            function previewFile(filePath) {
                try {
                    const fullUrl = window.location.origin + filePath;
                    console.log('Opening file:', fullUrl);

                    const newWindow = window.open(fullUrl, '_blank');

                    if (!newWindow) {
                        showResult('Error: Popup diblokir oleh browser. Silakan aktifkan popup untuk melihat file.', 'error');
                        return;
                    }

                    // Check if file loads successfully
                    newWindow.onload = () => {
                        showResult('‚úÖ File berhasil dibuka untuk preview!', 'success');
                    };

                    newWindow.onerror = () => {
                        showResult('‚ùå File tidak dapat dimuat. Periksa path file atau pengaturan server.', 'error');
                    };

                    showResult('üîÑ Membuka file untuk preview...', 'info');
                } catch (error) {
                    console.error('Error opening file:', error);
                    showResult('‚ùå Terjadi kesalahan saat membuka file: ' + error.message, 'error');
                }
            }

            function downloadFile(filePath, fileName) {
                try {
                    const fullUrl = window.location.origin + filePath;
                    console.log('Downloading file:', fullUrl);

                    const link = document.createElement('a');
                    link.href = fullUrl;
                    link.download = fileName || filePath.split('/').pop();
                    link.style.display = 'none';

                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    showResult('‚úÖ Download dimulai untuk file: ' + fileName, 'success');
                } catch (error) {
                    console.error('Error downloading file:', error);
                    showResult('‚ùå Terjadi kesalahan saat mendownload file: ' + error.message, 'error');
                }
            }

            function showResult(message, type) {
                const output = document.getElementById('test-output');
                const timestamp = new Date().toLocaleTimeString();
                output.innerHTML += `<p class="${type}">[${timestamp}] ${message}</p>`;
            }

            // Test file accessibility on page load
            window.addEventListener('load', function () {
                showResult('üìù Halaman test dimuat. Silakan klik tombol untuk test file access.', 'info');
            });
        </script>
    </body>
</html>
